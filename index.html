<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Unsplash-cowry</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
      /* General styles */
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
      }

      /* Search Bar Styles */
      .search-bar {
        display: flex;
        justify-content: center;

        background-color: #dde3ea;
        padding: 80px;
        position: relative;
        z-index: 10; /* Ensures the search bar stays above the images */
      }
      .search-bar input {
        width: 100%;
        border: none;
        border-radius: 4px;
        background-color: #fff;
      }
      .search-bar button {
        display: none;
      }

      /* Grid Styles */

      .image-grid {
        position: relative;
        top: -25px;
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* Fixed 3 columns */
        gap: 40px;
        padding: 0 250px;
        margin-bottom: 20px;
        z-index: 999;
      }

      .image-container {
        position: relative;
        overflow: hidden;
        height: min-content;
        border-radius: 8px;
      }

      .image-container img {
        width: 100%;
        height: auto;
        border-radius: 8px;
        display: block;
        cursor: pointer;
      }

      .overlay {
        position: absolute; /* Change to absolute */
        bottom: 7%; /* Align to the bottom */
        left: 0; /* Align to the left */
        right: 0; /* Stretch across */
        color: #fff; /* Text color */

        padding: 10px; /* Add padding for spacing */
        box-sizing: border-box; /* Ensure padding doesn't affect width */
      }

      .image-container:hover .overlay {
        opacity: 1; /* Show overlay on hover */
      }

      /* Modal Styles */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .modal-content {
        border-radius: 8px;
        max-width: 600px;
        width: 100%;
        text-align: center;
        position: relative; /* Make it relative for positioning overlay */
      }

      .modal img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
      }

      /* Image Info Overlay in Modal */
      .modal-overlay {
        position: absolute;
        bottom: 0; /* Align to the bottom */
        left: 0; /* Align to the left */

        color: #fff; /* Text color */
        padding: 10px; /* Add padding for spacing */
        box-sizing: border-box; /* Ensure padding doesn't affect width */
      }

      /* Skeleton Loader Styles */
      .skeleton {
        background-color: #ddd;
        border-radius: 8px;
        margin-bottom: 20px;
        position: relative;
      }

      .skeleton-image {
        width: 100%;
        height: 200px;
        background-color: #e0e0e0;
        border-radius: 8px;
      }

      .skeleton-text {
        height: 16px;
        background-color: #ccc;
        margin-top: 10px;
        border-radius: 4px;
      }

      .skeleton-author {
        width: 50%;
      }

      .skeleton-location {
        width: 70%;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>
    <script type="text/javascript">
      const app = Vue.createApp({
        data() {
          return {
            images: [],
            isLoading: true,
            error: null,
            modalImage: null, // Holds the data of the clicked image
            page: 1,
            perPage: 6,
            query: "", // Holds the search query
            isFetching: false, // Prevents multiple fetch requests
          };
        },
        methods: {
          async fetchImages() {
            if (this.isFetching) return; // Prevent duplicate fetching
            this.isFetching = true; // Set fetching state to true
            this.isLoading = true; // Trigger loading state

            try {
              const url = this.query
                ? `https://api.unsplash.com/search/photos/?client_id=ruLlONT6ashgc3z7y0B_35EyFnpUqcfbu0sJW4D96y4&query=${this.query}&page=${this.page}&per_page=${this.perPage}`
                : `https://api.unsplash.com/photos/?client_id=ruLlONT6ashgc3z7y0B_35EyFnpUqcfbu0sJW4D96y4&page=${this.page}&per_page=${this.perPage}`;

              const response = await fetch(url);
              const data = this.query
                ? (await response.json()).results
                : await response.json();

              const newImages = data.map((item) => ({
                small: item.urls.small,
                full: item.urls.full,
                description: item.alt_description,
                author: item.user.name,
                location: item.location
                  ? item.location.name
                  : "Unknown Location",
              }));

              // Simulate a 1-second loading delay using setTimeout
              setTimeout(() => {
                this.images = [...this.images, ...newImages]; // Append new images
                this.page++; // Increment page for next fetch
                this.isLoading = false; // Stop loading after images are fetched
                this.isFetching = false;
              }, 1000); // 1-second delay
            } catch (error) {
              console.log("Error fetching images", error);
              this.error = "Fetching failed ...please try again later...";
              this.isLoading = false;
              this.isFetching = false;
            }
          },
          async searchImages() {
            if (this.isFetching) return; // Prevent duplicate fetching
            this.isFetching = true; // Set fetching state to true
            this.isLoading = true; // Trigger loading state
            this.page = 1; // Reset page for new search
            this.images = []; // Clear previous images

            try {
              const response = await fetch(
                `https://api.unsplash.com/search/photos/?client_id=ruLlONT6ashgc3z7y0B_35EyFnpUqcfbu0sJW4D96y4&query=${this.query}&page=${this.page}&per_page=${this.perPage}`
              );
              const data = await response.json();
              this.images = data.results.map((item) => ({
                small: item.urls.small,
                full: item.urls.full,
                description: item.alt_description,
                author: item.user.name,
                location: item.location
                  ? item.location.name
                  : "Unknown Location",
              }));
              this.isLoading = false;
              this.isFetching = false;
            } catch (error) {
              console.log("Error fetching search results", error);
              this.error =
                "Fetching search results failed. Please try again later.";
              this.isLoading = false;
              this.isFetching = false;
            }
          },
          openModal(image) {
            this.modalImage = image; // Set the clicked image's data to modalImage
          },
          closeModal() {
            this.modalImage = null; // Clear the modalImage to close the modal
          },
          handleScroll() {
            const scrollHeight = document.documentElement.scrollHeight;
            const scrollTop = document.documentElement.scrollTop;
            const clientHeight = document.documentElement.clientHeight;

            if (scrollTop + clientHeight >= scrollHeight - 10) {
              // If scrolled to the bottom, fetch more images
              this.fetchImages();
            }
          },
        },
        mounted() {
          // Initial fetch of images
          this.fetchImages();

          // Add scroll event listener
          window.addEventListener("scroll", this.handleScroll);
        },
        unmounted() {
          // Clean up event listener when component is destroyed
          window.removeEventListener("scroll", this.handleScroll);
        },
        template: `
<div>
    <div class="search-bar">
        <input
            v-model="query"
            @keyup.enter="searchImages" 
            type="text"
            placeholder="Search for photo"
            style="padding: 8px; width: 300px;"
        />
        <button @click="searchImages">Search</button>
    </div>

    <div class="image-grid">
        <!-- Show skeleton loaders based on perPage -->
        <div v-if="isLoading" v-for="n in perPage" :key="n" class="skeleton">
            <div class="skeleton-image"></div>
            <div class="skeleton-text skeleton-author"></div>
            <div class="skeleton-text skeleton-location"></div>
        </div>

        <div v-if="error" class="error">{{ error }}</div>
        <div
            v-for="image in images"
            :key="image.small"
            class="image-container"
            @click="openModal(image)"
        >

            <img :src="image.small" :alt="image.description" />
            <div class="overlay">
                <div>{{ image.author }}</div>
                <div>{{ image.location }}</div>
            </div>
        </div>
    </div>

    <div v-if="modalImage" class="modal" @click="closeModal">
        <div class="modal-content" @click.stop>
            <img :src="modalImage.full" :alt="modalImage.description" />
            <div class="modal-overlay">
                <div>{{ modalImage.author }}</div>
                <div>{{ modalImage.location }}</div>
            </div>
        </div>
    </div>
</div>
`,
      });
      app.mount("#app");
    </script>
  </body>
</html>
